import streamlit as st
from itertools import combinations

# ===============================
# 페이지 & 테마 스타일
# ===============================
st.set_page_config(page_title="주기율표 결합 학습", layout="wide")

STICKER_CSS = """
<style>
/* 배경: 하늘색-흰색 그라데이션 */
body { background: linear-gradient(135deg, #E9F6FF 0%, #FFFFFF 60%); }

/* 과학 스티커(emoji) 효과 */
.stApp:before, .stApp:after {
  content: "🧪   🔬   ⚗️   🧬";
  position: fixed;
  z-index: -1;
  font-size: 42px;
  opacity: 0.08;
  color: #0077b6;
}
.stApp:before { top: 8%; left: 6%; transform: rotate(-12deg); }
.stApp:after  { bottom: 8%; right: 6%; transform: rotate(10deg); }

/* 카드형 셀 공통 스타일 */
.element-card {
  border-radius: 14px;
  padding: 10px 8px;
  margin: 6px 4px;
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 2px 10px rgba(0, 60, 120, 0.06);
  cursor: pointer;
  transition: transform .05s ease-in-out, box-shadow .2s ease;
}
.element-card:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(0, 60, 120, 0.10);
}
.element-symbol { font-weight: 800; font-size: 18px; line-height: 1; }
.element-number { font-size: 11px; opacity: .8; }
.element-name { font-size: 12px; opacity: .9; }
.badge { font-size: 10px; padding: 2px 6px; border-radius: 999px; background: rgba(0,0,0,.08); }
</style>
"""
st.markdown(STICKER_CSS, unsafe_allow_html=True)

st.title("🔬 주기율표 결합 학습 (118 원소)")

st.caption("원소 칸을 눌러 선택하세요. 금속은 하늘색, 준금속·비금속은 연노란색으로 구분했습니다. "
           "두 개 이상 선택하면 결합 종류와 특징, 생성 물질의 성질을 알려드립니다.")

# ===============================
# 색상/분류 유틸
# ===============================
COLOR_METAL = "#ADD8E6"     # 하늘색
COLOR_NONMET = "#FFF8B5"    # 연노란색 (비금속 + 준금속)

def cell_color(category: str) -> str:
    return COLOR_METAL if category == "금속" else COLOR_NONMET

# ===============================
# 118개 원소 데이터 (번호, 기호, 이름, 분류, 특징)
# 분류: 금속 / 준금속 / 비금속
# ===============================
elements = [
    {"번호":1,"기호":"H","이름":"수소","분류":"비금속","특징":"가장 가벼운 원소, 연료·환원제·암모니아 합성에 쓰임"},
    {"번호":2,"기호":"He","이름":"헬륨","분류":"비금속","특징":"불활성 기체, 낮은 끓는점으로 초전도체 냉각에 사용"},
    {"번호":3,"기호":"Li","이름":"리튬","분류":"금속","특징":"가벼운 알칼리 금속, 2차전지 핵심"},
    {"번호":4,"기호":"Be","이름":"베릴륨","분류":"금속","특징":"가볍고 강함, 항공·우주 합금"},
    {"번호":5,"기호":"B","이름":"붕소","분류":"준금속","특징":"유리·세라믹 강화, 반도체 도핑"},
    {"번호":6,"기호":"C","이름":"탄소","분류":"비금속","특징":"생명체의 기본, 다이아몬드·흑연·그래핀 동소체"},
    {"번호":7,"기호":"N","이름":"질소","분류":"비금속","특징":"대기 78%, 비료·폭약·냉각"},
    {"번호":8,"기호":"O","이름":"산소","분류":"비금속","특징":"호흡·연소 필수, 강한 산화제"},
    {"번호":9,"기호":"F","이름":"플루오린","분류":"비금속","특징":"가장 전기음성도 큼, 반응성 매우 큼"},
    {"번호":10,"기호":"Ne","이름":"네온","분류":"비금속","특징":"불활성 기체, 방전등"},
    {"번호":11,"기호":"Na","이름":"나트륨","분류":"금속","특징":"알칼리 금속, 소금 구성 이온"},
    {"번호":12,"기호":"Mg","이름":"마그네슘","분류":"금속","특징":"가벼운 구조재 합금, 엽록소 중심 금속"},
    {"번호":13,"기호":"Al","이름":"알루미늄","분류":"금속","특징":"가벼움·내식성, 포일·캔·항공"},
    {"번호":14,"기호":"Si","이름":"규소","분류":"준금속","특징":"반도체 핵심, 유리·규사"},
    {"번호":15,"기호":"P","이름":"인","분류":"비금속","특징":"DNA·ATP 구성, 비료"},
    {"번호":16,"기호":"S","이름":"황","분류":"비금속","특징":"황산·고무가황·비료"},
    {"번호":17,"기호":"Cl","이름":"염소","분류":"비금속","특징":"소독·PVC 제조"},
    {"번호":18,"기호":"Ar","이름":"아르곤","분류":"비금속","특징":"불활성 기체, 용접 보호"},
    {"번호":19,"기호":"K","이름":"칼륨","분류":"금속","특징":"알칼리 금속, 비료 중요 성분"},
    {"번호":20,"기호":"Ca","이름":"칼슘","분류":"금속","특징":"뼈·치아 구성, 석회석"},
    {"번호":21,"기호":"Sc","이름":"스칸듐","분류":"금속","특징":"경량 합금 첨가제"},
    {"번호":22,"기호":"Ti","이름":"티타늄","분류":"금속","특징":"강도 대비 가볍고 내식성, 임플란트·항공"},
    {"번호":23,"기호":"V","이름":"바나듐","분류":"금속","특징":"강철 강화 첨가"},
    {"번호":24,"기호":"Cr","이름":"크로뮴","분류":"금속","특징":"스테인리스강, 도금"},
    {"번호":25,"기호":"Mn","이름":"망간","분류":"금속","특징":"강철 합금 원소"},
    {"번호":26,"기호":"Fe","이름":"철","분류":"금속","특징":"강철·건축·산업 핵심"},
    {"번호":27,"기호":"Co","이름":"코발트","분류":"금속","특징":"배터리·초합금·자석"},
    {"번호":28,"기호":"Ni","이름":"니켈","분류":"금속","특징":"스테인리스·도금"},
    {"번호":29,"기호":"Cu","이름":"구리","분류":"금속","특징":"전기·열 전도 우수, 전선"},
    {"번호":30,"기호":"Zn","이름":"아연","분류":"금속","특징":"도금·배터리"},
    {"번호":31,"기호":"Ga","이름":"갈륨","분류":"금속","특징":"GaAs/ GaN 반도체·LED"},
    {"번호":32,"기호":"Ge","이름":"게르마늄","분류":"준금속","특징":"반도체·적외선 광학"},
    {"번호":33,"기호":"As","이름":"비소","분류":"준금속","특징":"반도체 소량 도핑, 독성"},
    {"번호":34,"기호":"Se","이름":"셀레늄","분류":"비금속","특징":"광전 효과·건강 미량원소"},
    {"번호":35,"기호":"Br","이름":"브로민","분류":"비금속","특징":"상온 액체 할로젠, 난연제"},
    {"번호":36,"기호":"Kr","이름":"크립톤","분류":"비금속","특징":"방전등·레이저"},
    {"번호":37,"기호":"Rb","이름":"루비듐","분류":"금속","특징":"알칼리 금속, 원자시계"},
    {"번호":38,"기호":"Sr","이름":"스트론튬","분류":"금속","특징":"불꽃놀이 적색, 세라믹"},
    {"번호":39,"기호":"Y","이름":"이트륨","분류":"금속","특징":"LED 형광체·초전도체"},
    {"번호":40,"기호":"Zr","이름":"지르코늄","분류":"금속","특징":"내식성, 원자로 피복재"},
    {"번호":41,"기호":"Nb","이름":"나이오븀","분류":"금속","특징":"초전도체·합금"},
    {"번호":42,"기호":"Mo","이름":"몰리브데넘","분류":"금속","특징":"고온 합금·촉매"},
    {"번호":43,"기호":"Tc","이름":"테크네튬","분류":"금속","특징":"방사성, 의료 진단 동위원소"},
    {"번호":44,"기호":"Ru","이름":"루테늄","분류":"금속","특징":"촉매·전극"},
    {"번호":45,"기호":"Rh","이름":"로듐","분류":"금속","특징":"자동차 촉매, 귀금속"},
    {"번호":46,"기호":"Pd","이름":"팔라듐","분류":"금속","특징":"촉매·수소 흡장"},
    {"번호":47,"기호":"Ag","이름":"은","분류":"금속","특징":"전기전도 최고, 귀금속"},
    {"번호":48,"기호":"Cd","이름":"카드뮴","분류":"금속","특징":"배터리·도금, 독성"},
    {"번호":49,"기호":"In","이름":"인듐","분류":"금속","특징":"ITO 전극, 디스플레이"},
    {"번호":50,"기호":"Sn","이름":"주석","분류":"금속","특징":"땜납·주석도금"},
    {"번호":51,"기호":"Sb","이름":"안티몬","분류":"준금속","특징":"난연제·반도체 합금"},
    {"번호":52,"기호":"Te","이름":"텔루륨","분류":"준금속","특징":"열전·태양전지 합금"},
    {"번호":53,"기호":"I","이름":"아이오딘","분류":"비금속","특징":"소독제·갑상선 호르몬"},
    {"번호":54,"기호":"Xe","이름":"제논","분류":"비금속","특징":"헤드램프·마취제"},
    {"번호":55,"기호":"Cs","이름":"세슘","분류":"금속","특징":"원자시계, 반응성 큼"},
    {"번호":56,"기호":"Ba","이름":"바륨","분류":"금속","특징":"X선 조영제·불꽃놀이"},
    {"번호":57,"기호":"La","이름":"란타넘","분류":"금속","특징":"배터리·촉매"},
    {"번호":58,"기호":"Ce","이름":"세륨","분류":"금속","특징":"연마제·촉매"},
    {"번호":59,"기호":"Pr","이름":"프라세오디뮴","분류":"금속","특징":"자석·유리 착색"},
    {"번호":60,"기호":"Nd","이름":"네오디뮴","분류":"금속","특징":"초강력 영구자석"},
    {"번호":61,"기호":"Pm","이름":"프로메튬","분류":"금속","특징":"방사성 희토류"},
    {"번호":62,"기호":"Sm","이름":"사마륨","분류":"금속","특징":"SmCo 자석·원자로"},
    {"번호":63,"기호":"Eu","이름":"유로퓸","분류":"금속","특징":"형광체 적색 발광"},
    {"번호":64,"기호":"Gd","이름":"가돌리늄","분류":"금속","특징":"MRI 조영제·중성자 흡수"},
    {"번호":65,"기호":"Tb","이름":"터븀","분류":"금속","특징":"형광체·자석"},
    {"번호":66,"기호":"Dy","이름":"디스프로슘","분류":"금속","특징":"자석 고온 안정화"},
    {"번호":67,"기호":"Ho","이름":"홀뮴","분류":"금속","특징":"레이저·자성 재료"},
    {"번호":68,"기호":"Er","이름":"어븀","분류":"금속","특징":"광섬유 증폭기 도핑"},
    {"번호":69,"기호":"Tm","이름":"툴륨","분류":"금속","특징":"레이저·연구용"},
    {"번호":70,"기호":"Yb","이름":"이터븀","분류":"금속","특징":"레이저·합금"},
    {"번호":71,"기호":"Lu","이름":"루테튬","분류":"금속","특징":"PET·촉매"},
    {"번호":72,"기호":"Hf","이름":"하프늄","분류":"금속","특징":"원자로 제어봉·내열"},
    {"번호":73,"기호":"Ta","이름":"탄탈럼","분류":"금속","특징":"콘덴서·내식성"},
    {"번호":74,"기호":"W","이름":"텅스텐","분류":"금속","특징":"높은 융점, 공구강·필라멘트"},
    {"번호":75,"기호":"Re","이름":"레늄","분류":"금속","특징":"초합금·촉매"},
    {"번호":76,"기호":"Os","이름":"오스뮴","분류":"금속","특징":"밀도 매우 큼, 합금"},
    {"번호":77,"기호":"Ir","이름":"이리듐","분류":"금속","특징":"내식성 최고급, 촉매"},
    {"번호":78,"기호":"Pt","이름":"백금","분류":"금속","특징":"귀금속·촉매·센서"},
    {"번호":79,"기호":"Au","이름":"금","분류":"금속","특징":"귀금속·전자·장신구"},
    {"번호":80,"기호":"Hg","이름":"수은","분류":"금속","특징":"상온 액체 금속·독성"},
    {"번호":81,"기호":"Tl","이름":"탈륨","분류":"금속","특징":"전자재료·독성"},
    {"번호":82,"기호":"Pb","이름":"납","분류":"금속","특징":"배터리·방사선 차폐·독성"},
    {"번호":83,"기호":"Bi","이름":"비스무트","분류":"금속","특징":"저독성 합금·의약"},
    {"번호":84,"기호":"Po","이름":"폴로늄","분류":"준금속","특징":"방사성, 드문 준금속"},
    {"번호":85,"기호":"At","이름":"아스타틴","분류":"비금속","특징":"아주 희귀한 방사성 할로젠"},
    {"번호":86,"기호":"Rn","이름":"라돈","분류":"비금속","특징":"방사성 비활성 기체"},
    {"번호":87,"기호":"Fr","이름":"프랑슘","분류":"금속","특징":"희귀 알칼리 금속, 강한 방사성"},
    {"번호":88,"기호":"Ra","이름":"라듐","분류":"금속","특징":"알칼리 토금속, 방사성"},
    {"번호":89,"기호":"Ac","이름":"악티늄","분류":"금속","특징":"방사성, 연구용"},
    {"번호":90,"기호":"Th","이름":"토륨","분류":"금속","특징":"원자로 연료 후보"},
    {"번호":91,"기호":"Pa","이름":"프로트악티늄","분류":"금속","특징":"희귀 방사성 금속"},
    {"번호":92,"기호":"U","이름":"우라늄","분류":"금속","특징":"원자력 연료"},
    {"번호":93,"기호":"Np","이름":"넵투늄","분류":"금속","특징":"방사성, 연구"},
    {"번호":94,"기호":"Pu","이름":"플루토늄","분류":"금속","특징":"원자로·핵기술"},
    {"번호":95,"기호":"Am","이름":"아메리슘","분류":"금속","특징":"연기 감지기 방사선원"},
    {"번호":96,"기호":"Cm","이름":"퀴륨","분류":"금속","특징":"방사성, 연구"},
    {"번호":97,"기호":"Bk","이름":"버클륨","분류":"금속","특징":"인공 방사성 원소"},
    {"번호":98,"기호":"Cf","이름":"캘리포늄","분류":"금속","특징":"중성자원, 분석·원자로 시동"},
    {"번호":99,"기호":"Es","이름":"아인슈타이늄","분류":"금속","특징":"인공, 연구"},
    {"번호":100,"기호":"Fm","이름":"페르뮴","분류":"금속","특징":"인공, 연구"},
    {"번호":101,"기호":"Md","이름":"멘델레븀","분류":"금속","특징":"인공, 연구"},
    {"번호":102,"기호":"No","이름":"노벨륨","분류":"금속","특징":"인공, 연구"},
    {"번호":103,"기호":"Lr","이름":"로렌슘","분류":"금속","특징":"인공, 연구"},
    {"번호":104,"기호":"Rf","이름":"러더포듐","분류":"금속","특징":"초중원소, 연구"},
    {"번호":105,"기호":"Db","이름":"더브늄","분류":"금속","특징":"초중원소, 연구"},
    {"번호":106,"기호":"Sg","이름":"시보귬","분류":"금속","특징":"초중원소, 연구"},
    {"번호":107,"기호":"Bh","이름":"보륨","분류":"금속","특징":"초중원소, 연구"},
    {"번호":108,"기호":"Hs","이름":"하슘","분류":"금속","특징":"초중원소, 연구"},
    {"번호":109,"기호":"Mt","이름":"마이트너륨","분류":"금속","특징":"초중원소, 연구"},
    {"번호":110,"기호":"Ds","이름":"다름슈타튬","분류":"금속","특징":"초중원소, 연구"},
    {"번호":111,"기호":"Rg","이름":"뢴트게늄","분류":"금속","특징":"초중원소, 연구"},
    {"번호":112,"기호":"Cn","이름":"코페르니슘","분류":"금속","특징":"초중원소, 연구"},
    {"번호":113,"기호":"Nh","이름":"니호늄","분류":"금속","특징":"인공 초중원소"},
    {"번호":114,"기호":"Fl","이름":"플레로븀","분류":"금속","특징":"인공 초중원소"},
    {"번호":115,"기호":"Mc","이름":"모스코븀","분류":"금속","특징":"인공 초중원소"},
    {"번호":116,"기호":"Lv","이름":"리버모륨","분류":"금속","특징":"인공 초중원소"},
    {"번호":117,"기호":"Ts","이름":"테네신","분류":"비금속","특징":"인공 할로젠 성격"},
    {"번호":118,"기호":"Og","이름":"오가네손","분류":"비금속","특징":"가장 무거운 비활성 기체 성격의 인공 원소"},
]

# 인덱스 빠른 접근
by_symbol = {e["기호"]: e for e in elements}

# ===============================
# 선택 상태 관리
# ===============================
if "selected_symbols" not in st.session_state:
    st.session_state.selected_symbols = set()

# ===============================
# 그리드 표시 (18열 구성)
# 실제 주기율표 자리 배치까지 재현하면 매우 길어져
# 여기서는 18열 반복으로 균등 배치합니다.
# ===============================
cols = st.columns(18)

def render_cell(el):
    selected = el["기호"] in st.session_state.selected_symbols
    bg = cell_color(el["분류"])
    outline = "3px solid #1c6dd0" if selected else "1px solid rgba(0,0,0,0.08)"
    txt = f"""
    <div class="element-card" style="background:{bg}; border:{outline}"
         onclick="document.getElementById('toggle_{el['기호']}').click();">
      <div class="element-number">#{el['번호']}</div>
      <div class="element-symbol">{el['기호']}</div>
      <div class="element-name">{el['이름']} <span class="badge">{el['분류']}</span></div>
    </div>
    """
    st.markdown(txt, unsafe_allow_html=True)
    st.checkbox(" ", key=f"toggle_{el['기호']}", value=selected, label_visibility="collapsed")

# 배치 및 토글 반영
for i, el in enumerate(elements):
    with cols[i % 18]:
        render_cell(el)
        # 토글 상태 읽어 선택 집합 업데이트
        if st.session_state.get(f"toggle_{el['기호']}"):
            st.session_state.selected_symbols.add(el["기호"])
        else:
            st.session_state.selected_symbols.discard(el["기호"])

# ===============================
# 선택된 원소 정보 출력
# ===============================
selected_list = [by_symbol[s] for s in sorted(st.session_state.selected_symbols, key=lambda x: by_symbol[x]["번호"])]

if selected_list:
    st.subheader("📌 선택한 원소")
    for el in selected_list:
        st.markdown(
            f"""
            <div style="background:{cell_color(el['분류'])}; padding:12px; border-radius:12px; margin:6px 0;
                        border:1px solid rgba(0,0,0,.06)">
              <b>#{el['번호']} {el['기호']} — {el['이름']}</b><br/>
              분류: {el['분류']}<br/>
              특징: {el['특징']}
            </div>
            """,
            unsafe_allow_html=True
        )

# ===============================
# 결합 로직
# ===============================
def bond_info(a_cat, b_cat):
    # 금속 vs (비금속/준금속) -> 이온결합
    # 금속 vs 금속 -> 금속결합
    # (비금속/준금속) vs (비금속/준금속) -> 공유결합
    metals = {"금속"}
    nm = {"비금속", "준금속"}
    if a_cat in metals and b_cat in metals:
        return (
            "금속 결합",
            "금속 양이온 사이를 자유 전자(전자 바다)가 매개하는 결합.",
            "전기·열 전도 우수, 광택·연성·전성, 결정격자 형성."
        )
    elif (a_cat in metals and b_cat in nm) or (b_cat in metals and a_cat in nm):
        return (
            "이온 결합",
            "금속이 전자를 잃어 양이온, 비금속/준금속이 받아 음이온이 되어 정전기적 인력으로 결합.",
            "높은 녹는점/끓는점, 용융·수용액 상태에서 전기전도, 결정성 고체."
        )
    else:
        return (
            "공유 결합",
            "원자들이 전자쌍을 공유하여 분자나 거대공유결정 형성.",
            "분자는 비교적 낮은 녹는점/끓는점, 전기전도 낮음(흑연 예외), 방향성 결합."
        )

# 2개 이상 선택 시 쌍별 분석
if len(selected_list) >= 2:
    st.subheader("🔗 결합 분석")
    for a, b in combinations(selected_list, 2):
        btype, bdesc, mprop = bond_info(a["분류"], b["분류"])
        st.markdown(
            f"""
            <div style="background:#ffffff; border-left:6px solid #1c6dd0; padding:12px 14px; margin:10px 0; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.04)">
              <div><b>{a['이름']}({a['기호']}) + {b['이름']}({b['기호']})</b></div>
              <div>결합 종류: <b>{btype}</b></div>
              <div>결합 특징: {bdesc}</div>
              <div>생성 물질의 성질: {mprop}</div>
              <details style="margin-top:8px;">
                <summary>각 원소의 특징 다시 보기</summary>
                <div style="padding-top:6px;">
                  • #{a['번호']} {a['기호']} ({a['분류']}): {a['특징']}<br/>
                  • #{b['번호']} {b['기호']} ({b['분류']}): {b['특징']}
                </div>
              </details>
            </div>
            """,
            unsafe_allow_html=True
        )

# 리셋 버튼
col_a, col_b = st.columns([1,3])
with col_a:
    if st.button("🔄 선택 초기화"):
        for e in elements:
            k = f"toggle_{e['기호']}"
            if k in st.session_state:
                st.session_state[k] = False
        st.session_state.selected_symbols = set()
        st.experimental_rerun()

with col_b:
    st.info("팁: 금속(하늘색)과 비금속/준금속(노란색)을 섞어 선택하면 **이온 결합** 사례를, "
            "비금속끼리 선택하면 **공유 결합**, 금속끼리는 **금속 결합** 예시를 볼 수 있어요.")
