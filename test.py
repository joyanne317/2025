import streamlit as st
from itertools import combinations

# ===============================
# í˜ì´ì§€ & ì „ì—­ ìŠ¤íƒ€ì¼
# ===============================
st.set_page_config(page_title="ì£¼ê¸°ìœ¨í‘œ ê²°í•© í•™ìŠµ (1~5ì£¼ê¸°)", layout="wide")

st.markdown("""
<style>
body { background: linear-gradient(135deg, #E9F6FF 0%, #FFFFFF 65%); }

/* í¬ë¯¸í•œ ê³¼í•™ ìŠ¤í‹°ì»¤ ëŠë‚Œ ì´ëª¨ì§€ */
.stApp:before, .stApp:after {
  content: "ğŸ§ª  ğŸ”¬  âš—ï¸  ğŸ§¬";
  position: fixed; z-index: -1; font-size: 40px; opacity: .06; color: #0c6cd4;
}
.stApp:before { top: 6%; left: 5%; transform: rotate(-10deg); }
.stApp:after  { bottom: 7%; right: 6%; transform: rotate(12deg); }

/* ì…€ ìŠ¤íƒ€ì¼: ë„¤ëª¨ + ë‘¥ê·¼ ëª¨ì„œë¦¬ */
.cell {
  border-radius: 12px;
  padding: 6px 6px;
  margin: 4px 2px;
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 1px 6px rgba(0, 70, 140, .07);
  text-align: center;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial, "Helvetica Neue", Helvetica, sans-serif;
  min-height: 44px;
}
.cell:hover { box-shadow: 0 4px 12px rgba(0, 70, 140, .12); }
.cell .line { font-weight: 800; font-size: 13px; line-height: 1; }

/* ì •ë³´ ì¹´ë“œ */
.card {
  background:#fff; border-left:6px solid #1c6dd0; padding:12px 14px; margin:10px 0;
  border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.05)
}

/* ì²´í¬ë°•ìŠ¤ ê°„ê²© ì¤„ì´ê¸° */
.block-container .stCheckbox { margin-top: -6px; }
</style>
""", unsafe_allow_html=True)

st.title("ğŸ”¬ ì£¼ê¸°ìœ¨í‘œ ê²°í•© í•™ìŠµ (1~5ì£¼ê¸°, #1~#54)")
st.caption("ê¸ˆì†: í•˜ëŠ˜ìƒ‰, ì¤€ê¸ˆì†Â·ë¹„ê¸ˆì†: ë…¸ë€ìƒ‰. ì¹¸ì„ í† ê¸€(ì²´í¬)í•´ ì„ íƒí•˜ì„¸ìš”. "
           "ë‘ ê°œ ì´ìƒ ì„ íƒí•˜ë©´ ê²°í•© ì¢…ë¥˜Â·íŠ¹ì§•Â·ìƒì„± ë¬¼ì§ˆì˜ ì„±ì§ˆì„ ë³´ì—¬ì¤ë‹ˆë‹¤.")

COLOR_METAL = "#ADD8E6"
COLOR_NONMET = "#FFF8B5"  # ì¤€ê¸ˆì†Â·ë¹„ê¸ˆì† ê³µí†µ

def cell_color(category: str) -> str:
    return COLOR_METAL if category == "ê¸ˆì†" else COLOR_NONMET

# =========================================================
# 1~54ë²ˆ(1~5ì£¼ê¸°) ì›ì†Œ ë°ì´í„°:
# (Z, Sym, Name, Category[ê¸ˆì†/ì¤€ê¸ˆì†/ë¹„ê¸ˆì†], Feature, Period, Group)
# =========================================================
E = [
 (1,"H","ìˆ˜ì†Œ","ë¹„ê¸ˆì†","ê°€ì¥ ê°€ë²¼ì›€Â·ì—°ë£ŒÂ·í™˜ì›ì œ",1,1),
 (2,"He","í—¬ë¥¨","ë¹„ê¸ˆì†","ë¶ˆí™œì„± ê¸°ì²´Â·ê·¹ì €ì˜¨ ëƒ‰ê°",1,18),

 (3,"Li","ë¦¬íŠ¬","ê¸ˆì†","ì•Œì¹¼ë¦¬ ê¸ˆì†Â·2ì°¨ì „ì§€",2,1),
 (4,"Be","ë² ë¦´ë¥¨","ê¸ˆì†","ê°€ë³ê³  ê°•í•¨Â·í•­ê³µí•©ê¸ˆ",2,2),
 (5,"B","ë¶•ì†Œ","ì¤€ê¸ˆì†","ìœ ë¦¬Â·ì„¸ë¼ë¯¹Â·ë°˜ë„ì²´ ë„í•‘",2,13),
 (6,"C","íƒ„ì†Œ","ë¹„ê¸ˆì†","ìƒëª… ê¸°ë³¸Â·í‘ì—°/ë‹¤ì´ì•„",2,14),
 (7,"N","ì§ˆì†Œ","ë¹„ê¸ˆì†","ëŒ€ê¸° 78%Â·ë¹„ë£ŒÂ·ëƒ‰ê°",2,15),
 (8,"O","ì‚°ì†Œ","ë¹„ê¸ˆì†","í˜¸í¡Â·ê°•í•œ ì‚°í™”ì œ",2,16),
 (9,"F","í”Œë£¨ì˜¤ë¦°","ë¹„ê¸ˆì†","ì „ê¸°ìŒì„±ë„ ìµœê³ Â·ë°˜ì‘ì„± í¼",2,17),
 (10,"Ne","ë„¤ì˜¨","ë¹„ê¸ˆì†","ë¶ˆí™œì„± ê¸°ì²´Â·ë°©ì „ë“±",2,18),

 (11,"Na","ë‚˜íŠ¸ë¥¨","ê¸ˆì†","ì†Œê¸ˆ êµ¬ì„±Â·ë°˜ì‘ì„± í¼",3,1),
 (12,"Mg","ë§ˆê·¸ë„¤ìŠ˜","ê¸ˆì†","ê°€ë²¼ìš´ í•©ê¸ˆÂ·ì—½ë¡ì†Œ",3,2),
 (13,"Al","ì•Œë£¨ë¯¸ëŠ„","ê¸ˆì†","ê°€ë²¼ì›€Â·ë‚´ì‹ì„±",3,13),
 (14,"Si","ê·œì†Œ","ì¤€ê¸ˆì†","ë°˜ë„ì²´ í•µì‹¬Â·ê·œì‚¬",3,14),
 (15,"P","ì¸","ë¹„ê¸ˆì†","DNAÂ·ATPÂ·ë¹„ë£Œ",3,15),
 (16,"S","í™©","ë¹„ê¸ˆì†","í™©ì‚°Â·ê°€í™©Â·ë¹„ë£Œ",3,16),
 (17,"Cl","ì—¼ì†Œ","ë¹„ê¸ˆì†","ì†Œë…Â·PVC",3,17),
 (18,"Ar","ì•„ë¥´ê³¤","ë¹„ê¸ˆì†","ë¶ˆí™œì„± ê¸°ì²´Â·ìš©ì ‘",3,18),

 (19,"K","ì¹¼ë¥¨","ê¸ˆì†","ì•Œì¹¼ë¦¬ ê¸ˆì†Â·ë¹„ë£Œ",4,1),
 (20,"Ca","ì¹¼ìŠ˜","ê¸ˆì†","ë¼ˆ/ì¹˜ì•„Â·ì„íšŒì„",4,2),
 (21,"Sc","ìŠ¤ì¹¸ë“","ê¸ˆì†","ê²½ëŸ‰ í•©ê¸ˆ",4,3),
 (22,"Ti","í‹°íƒ€ëŠ„","ê¸ˆì†","ê°•Â·ê°€ë²¼ì›€Â·ì„í”Œë€íŠ¸",4,4),
 (23,"V","ë°”ë‚˜ë“","ê¸ˆì†","ê°•ì²  ì²¨ê°€",4,5),
 (24,"Cr","í¬ë¡œë®´","ê¸ˆì†","ìŠ¤í…Œì¸ë¦¬ìŠ¤Â·ë„ê¸ˆ",4,6),
 (25,"Mn","ë§ê°„","ê¸ˆì†","ê°•ì²  í•©ê¸ˆ",4,7),
 (26,"Fe","ì² ","ê¸ˆì†","ê°•ì² Â·í•µì‹¬ ê¸ˆì†",4,8),
 (27,"Co","ì½”ë°œíŠ¸","ê¸ˆì†","ë°°í„°ë¦¬Â·ìì„",4,9),
 (28,"Ni","ë‹ˆì¼ˆ","ê¸ˆì†","ìŠ¤í…Œì¸ë¦¬ìŠ¤Â·ë„ê¸ˆ",4,10),
 (29,"Cu","êµ¬ë¦¬","ê¸ˆì†","ì „ë„ ìš°ìˆ˜Â·ì „ì„ ",4,11),
 (30,"Zn","ì•„ì—°","ê¸ˆì†","ë„ê¸ˆÂ·ë°°í„°ë¦¬",4,12),
 (31,"Ga","ê°ˆë¥¨","ê¸ˆì†","GaN/LEDÂ·ë°˜ë„ì²´",4,13),
 (32,"Ge","ê²Œë¥´ë§ˆëŠ„","ì¤€ê¸ˆì†","ë°˜ë„ì²´Â·ì ì™¸ì„ ",4,14),
 (33,"As","ë¹„ì†Œ","ì¤€ê¸ˆì†","ë„í•‘Â·ë…ì„±",4,15),
 (34,"Se","ì…€ë ˆëŠ„","ë¹„ê¸ˆì†","ê´‘ì „Â·ë¯¸ëŸ‰ì›ì†Œ",4,16),
 (35,"Br","ë¸Œë¡œë¯¼","ë¹„ê¸ˆì†","ì•¡ì²´ í• ë¡œì  Â·ë‚œì—°",4,17),
 (36,"Kr","í¬ë¦½í†¤","ë¹„ê¸ˆì†","ë°©ì „ë“±Â·ë ˆì´ì €",4,18),

 (37,"Rb","ë£¨ë¹„ë“","ê¸ˆì†","ì•Œì¹¼ë¦¬Â·ì›ìì‹œê³„",5,1),
 (38,"Sr","ìŠ¤íŠ¸ë¡ íŠ¬","ê¸ˆì†","ì ìƒ‰ ë¶ˆê½ƒÂ·ì„¸ë¼ë¯¹",5,2),
 (39,"Y","ì´íŠ¸ë¥¨","ê¸ˆì†","í˜•ê´‘ì²´Â·ì´ˆì „ë„",5,3),
 (40,"Zr","ì§€ë¥´ì½”ëŠ„","ê¸ˆì†","ë‚´ì‹Â·ì›ìë¡œ í”¼ë³µ",5,4),
 (41,"Nb","ë‚˜ì´ì˜¤ë¸€","ê¸ˆì†","ì´ˆì „ë„Â·í•©ê¸ˆ",5,5),
 (42,"Mo","ëª°ë¦¬ë¸Œë°ë„˜","ê¸ˆì†","ê³ ì˜¨ í•©ê¸ˆÂ·ì´‰ë§¤",5,6),
 (43,"Tc","í…Œí¬ë„¤íŠ¬","ê¸ˆì†","ì˜í•™ ë°©ì‚¬ì„± ë™ìœ„ì›ì†Œ",5,7),
 (44,"Ru","ë£¨í…ŒëŠ„","ê¸ˆì†","ì´‰ë§¤Â·ì „ê·¹",5,8),
 (45,"Rh","ë¡œë“","ê¸ˆì†","ìë™ì°¨ ì´‰ë§¤",5,9),
 (46,"Pd","íŒ”ë¼ë“","ê¸ˆì†","ì´‰ë§¤Â·ìˆ˜ì†Œ í¡ì¥",5,10),
 (47,"Ag","ì€","ê¸ˆì†","ì „ë„ ìµœê³ Â·ê·€ê¸ˆì†",5,11),
 (48,"Cd","ì¹´ë“œë®´","ê¸ˆì†","ë°°í„°ë¦¬Â·ë…ì„±",5,12),
 (49,"In","ì¸ë“","ê¸ˆì†","ITOÂ·ë””ìŠ¤í”Œë ˆì´",5,13),
 (50,"Sn","ì£¼ì„","ê¸ˆì†","ë•œë‚©Â·ë„ê¸ˆ",5,14),
 (51,"Sb","ì•ˆí‹°ëª¬","ì¤€ê¸ˆì†","ë‚œì—°Â·ë°˜ë„ì²´",5,15),
 (52,"Te","í…”ë£¨ë¥¨","ì¤€ê¸ˆì†","ì—´ì „Â·íƒœì–‘ì „ì§€",5,16),
 (53,"I","ì•„ì´ì˜¤ë”˜","ë¹„ê¸ˆì†","ì†Œë…Â·ê°‘ìƒì„ ",5,17),
 (54,"Xe","ì œë…¼","ë¹„ê¸ˆì†","í—¤ë“œë¨í”„Â·ë§ˆì·¨",5,18),
]

# ë¹ ë¥¸ ì ‘ê·¼ìš© ë”•ì…”ë„ˆë¦¬
by_sym = {sym: dict(Z=Z, Sym=sym, Name=nm, Cat=cat, Feat=feat, P=p, G=g) for (Z, sym, nm, cat, feat, p, g) in E}

# ===============================
# ì„ íƒ ìƒíƒœ
# ===============================
if "sel" not in st.session_state:
    st.session_state.sel = set()

# ===============================
# ì£¼ê¸°ìœ¨í‘œ ê·¸ë¦¬ë“œ (1~5ì£¼ê¸°, 18ì¡±)
# Noneì€ ë¹ˆ ì¹¸
# ===============================
def empty_cell():
    st.write("")

def render_element(sym):
    e = by_sym[sym]
    bg = cell_color(e["Cat"])
    st.markdown(
        f'<div class="cell" style="background:{bg}"><div class="line">#{e["Z"]} {e["Sym"]}</div></div>',
        unsafe_allow_html=True
    )
    # í† ê¸€ ì²´í¬ë°•ìŠ¤ (ì‘ê³  ë¼ë²¨ ìˆ¨ê¹€)
    checked = st.checkbox(" ", key=f"chk_{sym}", value=(sym in st.session_state.sel), label_visibility="collapsed")
    if checked: st.session_state.sel.add(sym)
    else: st.session_state.sel.discard(sym)

# ì‹¤ì œ ë°°ì¹˜ (1~5ì£¼ê¸°)
period_rows = {
    1: ["H"] + [None]*16 + ["He"],
    2: ["Li","Be"] + [None]*10 + ["B","C","N","O","F","Ne"],
    3: ["Na","Mg"] + [None]*10 + ["Al","Si","P","S","Cl","Ar"],
    4: ["K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr"],
    5: ["Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe"],
}

st.subheader("ğŸ“‹ ì£¼ê¸°ìœ¨í‘œ (1~5ì£¼ê¸°)")
for period in range(1, 6):
    st.markdown(f"**{period} ì£¼ê¸°**")
    row = period_rows[period]
    cols = st.columns(18)
    for i, col in enumerate(cols):
        with col:
            sym = row[i] if i < len(row) else None
            if sym is None:
                empty_cell()
            else:
                render_element(sym)

# ===============================
# ì„ íƒí•œ ì›ì†Œ ì •ë³´
# ===============================
selected = [by_sym[s] for s in sorted(st.session_state.sel, key=lambda s: by_sym[s]["Z"])]

if selected:
    st.subheader("ğŸ“Œ ì„ íƒí•œ ì›ì†Œ")
    for e in selected:
        st.markdown(
            f"""
            <div class="card" style="border-left-color:#1c6dd0">
              <b>#{e['Z']} {e['Sym']} â€” {e['Name']}</b><br/>
              ë¶„ë¥˜: {e['Cat']}<br/>
              íŠ¹ì§•: {e['Feat']}
            </div>
            """,
            unsafe_allow_html=True
        )

# ===============================
# ê²°í•© ë¡œì§ (í•™ìŠµìš© ë‹¨ìˆœí™”)
# ===============================
def bond_info(cat1, cat2):
    metals = {"ê¸ˆì†"}
    nonmet_like = {"ë¹„ê¸ˆì†", "ì¤€ê¸ˆì†"}
    if cat1 in metals and cat2 in metals:
        return ("ê¸ˆì† ê²°í•©",
                "ììœ  ì „ì(ì „ì ë°”ë‹¤)ê°€ ê¸ˆì† ì–‘ì´ì˜¨ ì‚¬ì´ë¥¼ ë§¤ê°œ.",
                "ì „ê¸°Â·ì—´ ì „ë„ ìš°ìˆ˜, ê´‘íƒ/ì—°ì„±/ì „ì„±, ê²°ì •ê²©ì.")
    if (cat1 in metals and cat2 in nonmet_like) or (cat2 in metals and cat1 in nonmet_like):
        return ("ì´ì˜¨ ê²°í•©",
                "ê¸ˆì†ì´ ì „ìë¥¼ ìƒì–´ ì–‘ì´ì˜¨, ë¹„/ì¤€ê¸ˆì†ì´ ë°›ì•„ ìŒì´ì˜¨ â†’ ì •ì „ê¸° ì¸ë ¥.",
                "ë†’ì€ ìœµì /ë“ëŠ”ì , ìš©ìœµÂ·ìˆ˜ìš©ì•¡ì—ì„œ ì „ë„, ë‹¨ë‹¨í•œ ê²°ì •.")
    return ("ê³µìœ  ê²°í•©",
            "ì „ììŒì„ ê³µìœ í•˜ì—¬ ë¶„ìÂ·ê±°ëŒ€ê³µìœ ê²°ì • í˜•ì„±.",
            "ë¶„ìëŠ” ë¹„êµì  ë‚®ì€ ìœµ/ë“ëŠ”ì , ì „ë„ì„± ë‚®ìŒ(í‘ì—° ì˜ˆì™¸), ë°©í–¥ì„±.")

if len(selected) >= 2:
    st.subheader("ğŸ”— ê²°í•© ë¶„ì„")
    for a, b in combinations(selected, 2):
        btype, bdesc, mprop = bond_info(a["Cat"], b["Cat"])
        st.markdown(
            f"""
            <div class="card">
              <div><b>{a['Name']}({a['Sym']}) + {b['Name']}({b['Sym']})</b></div>
              <div>ê²°í•© ì¢…ë¥˜: <b>{btype}</b></div>
              <div>ê²°í•© íŠ¹ì§•: {bdesc}</div>
              <div>ìƒì„± ë¬¼ì§ˆì˜ ì„±ì§ˆ: {mprop}</div>
              <details style="margin-top:8px;">
                <summary>ê° ì›ì†Œ íŠ¹ì§• ë‹¤ì‹œ ë³´ê¸°</summary>
                <div style="padding-top:6px;">
                  â€¢ #{a['Z']} {a['Sym']} ({a['Cat']}): {a['Feat']}<br/>
                  â€¢ #{b['Z']} {b['Sym']} ({b['Cat']}): {b['Feat']}
                </div>
              </details>
            </div>
            """,
            unsafe_allow_html=True
        )

# ===============================
# ë¦¬ì…‹ ë²„íŠ¼
# ===============================
left, right = st.columns([1,3])
with left:
    if st.button("ğŸ”„ ì„ íƒ ì´ˆê¸°í™”"):
        for k in list(st.session_state.keys()):
            if k.startswith("chk_"):
                st.session_state[k] = False
        st.session_state.sel = set()
        st.experimental_rerun()

with right:
    st.info("íŒ: í•˜ëŠ˜ìƒ‰(ê¸ˆì†) + ë…¸ë€ìƒ‰(ë¹„Â·ì¤€ê¸ˆì†)ì„ í•¨ê»˜ ì„ íƒí•˜ë©´ ì´ì˜¨ê²°í•© ì˜ˆì‹œë¥¼, "
            "ë…¸ë€ìƒ‰ë¼ë¦¬ëŠ” ê³µìœ ê²°í•©, í•˜ëŠ˜ìƒ‰ë¼ë¦¬ëŠ” ê¸ˆì†ê²°í•© ì˜ˆì‹œê°€ ë‚˜ì˜µë‹ˆë‹¤.")
